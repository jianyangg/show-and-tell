<!DOCTYPE html>
<html>
<head>
    <title>PIXI Background Test</title>
    <style>
        body { margin: 0; background: #333; }
        #status {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: monospace;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="status">Initializing...</div>
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@7/dist/pixi.min.js"></script>
    <script>
        const status = document.getElementById('status');

        function log(msg) {
            console.log(msg);
            status.innerHTML += '<br>' + msg;
        }

        async function test() {
            log('‚úÖ PIXI loaded');

            // Create PIXI app (same as main.js)
            const app = new PIXI.Application({
                width: window.innerWidth,
                height: window.innerHeight,
                backgroundColor: 0x333333
            });
            document.body.appendChild(app.view);
            log('‚úÖ PIXI app created');

            // Simulate base64 image (tiny test image)
            // This is a 1x1 red pixel PNG
            const testBase64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFBQIAX8jx0gAAAABJRU5ErkJggg==';

            log('üì• Decoding test image...');

            // Decode (same as main.js)
            const binaryString = atob(testBase64);
            const bytes = new Uint8Array(binaryString.length);
            for (let i = 0; i < binaryString.length; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }

            // Create blob
            const blob = new Blob([bytes], { type: 'image/png' });
            const imageUrl = URL.createObjectURL(blob);
            log(`‚úÖ Blob created: ${blob.size} bytes`);

            // Load via Image element
            const img = new Image();
            const promise = new Promise((resolve, reject) => {
                img.onload = () => {
                    log('‚úÖ Image loaded!');
                    resolve(img);
                };
                img.onerror = (e) => {
                    log('‚ùå Image failed to load: ' + e);
                    reject(e);
                };
            });
            img.src = imageUrl;

            await promise;
            log(`‚úÖ Image dimensions: ${img.width}x${img.height}`);

            // Create PIXI texture
            const texture = PIXI.Texture.from(img);
            log(`‚úÖ PIXI Texture: ${texture.width}x${texture.height}`);

            // Create sprite
            const sprite = new PIXI.Sprite(texture);
            sprite.alpha = 1.0;
            sprite.visible = true;

            // Scale to cover screen (make it huge so we can see it)
            const scale = Math.max(window.innerWidth, window.innerHeight);
            sprite.scale.set(scale);
            sprite.anchor.set(0.5, 0.5);
            sprite.x = window.innerWidth / 2;
            sprite.y = window.innerHeight / 2;

            log(`‚úÖ Sprite created at ${sprite.x}, ${sprite.y} with scale ${scale}`);

            // Add to stage at index 0
            app.stage.addChildAt(sprite, 0);
            log(`‚úÖ Sprite added to stage (children: ${app.stage.children.length})`);
            log('üìä You should see a red tint over the gray background');

            // Make it more visible by changing tint to bright red
            sprite.tint = 0xFF0000;
            log('üî¥ Sprite tinted bright red');
        }

        test().catch(e => {
            log('‚ùå ERROR: ' + e);
            console.error(e);
        });
    </script>
</body>
</html>
